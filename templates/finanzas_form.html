{% extends "base.html" %}
{% block content %}
<h2>{{ 'Editar' if finanza else 'Nuevo' }} Movimiento Financiero</h2>
<form method="post">
    <div class="mb-3">
        <label class="form-label">Tipo</label>
        <select name="tipo" class="form-control" id="tipoSelect">
            <option value="ingreso" {% if finanza and finanza.tipo == 'ingreso' %}selected{% endif %}>Ingreso</option>
            <option value="egreso" {% if finanza and finanza.tipo == 'egreso' %}selected{% endif %}>Egreso</option>
        </select>
    </div>
    <div class="mb-3" id="recibidoDeDiv" style="display: none;">
        <label class="form-label">Recibido de</label>
        <input type="text" name="recibido_de" value="{{ finanza.recibido_de if finanza and finanza.recibido_de else '' }}" class="form-control">
    </div>
    <div class="mb-3" id="estadoPagoDiv" style="display: none;">
        <label class="form-label">Estado de pago</label>
        <select name="estado_pago" class="form-control">
            <option value="Pagado" {% if finanza and finanza.estado_pago == 'Pagado' %}selected{% endif %}>Pagado</option>
            <option value="Pendiente" {% if finanza and finanza.estado_pago == 'Pendiente' %}selected{% endif %}>Pendiente</option>
        </select>
    </div>
    <div class="mb-3">
        <label class="form-label">Concepto</label>
        <input type="text" name="concepto" value="{{ finanza.concepto if finanza else '' }}" class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Monto</label>
        <input type="number" name="monto" value="{{ finanza.monto if finanza else '' }}" step="0.01" class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Fecha</label>
        <input type="date" name="fecha" value="{{ finanza.fecha if finanza else '' }}" class="form-control">
    </div>
    <div class="mb-3">
        <label class="form-label">Pensionista (opcional)</label>
        <select name="pensionista_id" class="form-control">
            <option value="">---</option>
            {% for p in pensionistas %}
                <option value="{{ p.id }}" {% if finanza and finanza.pensionista_id == p.id %}selected{% endif %}>{{ p.nombre }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-success">Guardar</button>
    <a href="/finanzas" class="btn btn-secondary">Cancelar</a>
</form>

<script>
    // Mostrar/ocultar campos seg√∫n el tipo seleccionado
    const tipoSelect = document.getElementById('tipoSelect');
    const recibidoDeDiv = document.getElementById('recibidoDeDiv');
    const estadoPagoDiv = document.getElementById('estadoPagoDiv');
    function toggleCampos() {
        recibidoDeDiv.style.display = (tipoSelect.value === 'ingreso') ? '' : 'none';
        estadoPagoDiv.style.display = (tipoSelect.value === 'egreso') ? '' : 'none';
    }
    tipoSelect.addEventListener('change', toggleCampos);
    window.addEventListener('DOMContentLoaded', toggleCampos); // Mostrar correcto al cargar
</script>
{% endblock %}
