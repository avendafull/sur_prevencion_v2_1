{% extends "base.html" %}
{% block content %}
<h2>Gestión de Finanzas</h2>
<a class="btn btn-primary mb-2" href="/finanzas/nueva">Nuevo Movimiento</a>
<table class="table table-striped">
    <thead>
        <tr>
            <th>Tipo</th>
            <th>Concepto</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th>Pensionista</th>
            <th>Recibido de</th>
            <th>Estado de Pago</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for f in finanzas %}
        <tr>
            <td>
                {% if f.tipo == 'ingreso' %}
                    <span class="badge bg-success">Ingreso</span>
                {% else %}
                    <span class="badge bg-danger">Egreso</span>
                {% endif %}
            </td>
            <td>{{ f.concepto }}</td>
            <td>S/ {{ "{:,.2f}".format(f.monto).replace(",", ".") }}</td>
            <td>{{ f.fecha.strftime('%d/%m/%Y') if f.fecha else '' }}</td>
            <td>{% if f.pensionista %}{{ f.pensionista.nombre }}{% endif %}</td>
            <td>
                {% if f.tipo == 'ingreso' %}
                    {{ f.recibido_de }}
                {% endif %}
            </td>
            <td>
                {% if f.tipo == 'egreso' %}
                    {% if f.estado_pago == 'Pagado' %}
                        <span class="badge bg-success">Pagado</span>
                    {% else %}
                        <span class="badge bg-warning text-dark">Pendiente</span>
                    {% endif %}
                {% endif %}
            </td>
            <td>
                <a href="/finanzas/editar/{{ f.id }}" class="btn btn-sm btn-warning">Editar</a>
                <a href="/finanzas/borrar/{{ f.id }}" class="btn btn-sm btn-danger" onclick="return confirm('¿Estás seguro de eliminar este movimiento?');">Borrar</a>
                {% if f.tipo == 'egreso' and f.estado_pago == 'Pendiente' %}
                    <form method="post" action="{{ url_for('marcar_pagado', id=f.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('¿Marcar este egreso como pagado?');">Marcar como Pagado</button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
